const form=document.getElementById("log-input-form"),formTextArea=document.getElementById("log-input-form-textarea"),results=document.getElementById("results"),cardValueMap={A:14,K:13,Q:12,J:11,T:10,9:9,8:8,7:7,6:6,5:5,4:4,3:3,2:2},handValueMap={AA:169,KK:168,QQ:167,AKs:166,JJ:165,AQs:164,KQs:163,AJs:162,KJs:161,TT:160,AKo:159,ATs:158,QJs:157,KTs:156,QTs:155,JTs:154,99:153,AQo:152,A9s:151,KQo:150,88:149,K9s:148,T9s:147,A8s:146,Q9s:145,J9s:144,AJo:143,A5s:142,77:141,A7s:140,KJo:139,A4s:138,A3s:137,A6s:136,QJo:135,66:134,K8s:133,T8s:132,A2s:131,"98s":130,J8s:129,ATo:128,Q8s:127,K7s:126,KTo:125,55:124,JTo:123,"87s":122,QTo:121,44:120,33:119,22:118,K6s:117,"97s":116,K5s:115,"76s":114,T7s:113,K4s:112,K3s:111,K2s:110,Q7s:109,"86s":108,"65s":107,J7s:106,"54s":105,Q6s:104,"75s":103,"96s":102,Q5s:101,"64s":100,Q4s:99,Q3s:98,T9o:97,T6s:96,Q2s:95,A9o:94,"53s":93,"85s":92,J6s:91,J9o:90,K9o:89,J5s:88,Q9o:87,"43s":86,"74s":85,J4s:84,J3s:83,"95s":82,J2s:81,"63s":80,A8o:79,"52s":78,T5s:77,"84s":76,T4s:75,T3s:74,"42s":73,T2s:72,"98o":71,T8o:70,A5o:69,A7o:68,"73s":67,A4o:66,"32s":65,"94s":64,"93s":63,J8o:62,A3o:61,"62s":60,"92s":59,K8o:58,A6o:57,"87o":56,Q8o:55,"83s":54,A2o:53,"82s":52,"97o":51,"72s":50,"76o":49,K7o:48,"65o":47,T7o:46,K6o:45,"86o":44,"54o":43,K5o:42,J7o:41,"75o":40,Q7o:39,K4o:38,K3o:37,"96o":36,K2o:35,"64o":34,Q6o:33,"53o":32,"85o":31,T6o:30,Q5o:29,"43o":28,Q4o:27,Q3o:26,"74o":25,Q2o:24,J6o:23,"63o":22,J5o:21,"95o":20,"52o":19,J4o:18,J3o:17,"42o":16,J2o:15,"84o":14,T5o:13,T4o:12,"32o":11,T3o:10,"73o":9,T2o:8,"62o":7,"94o":6,"93o":5,"92o":4,"83o":3,"82o":2,"72o":1},processLogLines=t=>{const e=t.filter((t=>t.startsWith('"Your hand is '))).map((t=>t.match(/(?:[2-9]|10|[JQKA])[♠️♦️♥️♣️]/g))).map((t=>{const e=t.map((t=>3===t.length?"T"+t.slice(-1):t)),s=e[0],a=e[1],o=s[0],n=a[0],l=s[1],r=a[1],d=[o,n].sort(((t,e)=>cardValueMap[t]-cardValueMap[e])).reverse().join("");let c="";return o!==n&&(c=l===r?"s":"o"),d+c})),s={};for(const t of e)s[t]=(s[t]||0)+1;return s},attachHeatmap=(t,e)=>{const s=20,a=0,o=30,n=0,l=Object.keys(cardValueMap).sort(((t,e)=>cardValueMap[t]-cardValueMap[e])).reverse(),r=[];for(const t of l)for(const s of l){const a={v1:t,v2:s};let o,n=!1,l=!1;t===s?(o=t+s,l=!0):cardValueMap[t]>cardValueMap[s]?o=t+s+"o":(o=s+t+"s",n=!0),a.label=o,a.count=e[o]||0,a.pair=l,a.suited=n,r.push(a)}const d=d3.select("#"+t).append("div").style("opacity",0).style("position","absolute").attr("class","tooltip"),c=Object.values(e).reduce(((t,e)=>t+e),0),i=d3.select("#"+t).append("svg").attr("width",500+o+n).attr("height",500+s+a).append("g").attr("transform",`translate(${o},${s})`),p=d3.scaleBand().range([0,500]).domain(l).padding(.01),u=d3.scaleBand().range([0,500]).domain(l).padding(.01);i.append("g").attr("class","x axis").call(d3.axisTop(p)),i.append("g").attr("class","y axis").call(d3.axisLeft(u));const m=d3.scaleLinear().range(["#f8f8f8","#be1931"]).domain([0,d3.max(Object.values(e))]);i.selectAll().data(r).join("rect").attr("x",(t=>p(t.v1))).attr("y",(t=>u(t.v2))).attr("width",p.bandwidth()).attr("height",u.bandwidth()).style("fill",(t=>m(t.count))).on("mouseover",((t,e)=>{const s=Math.round(c*(e.pair?6:e.suited?4:12)/1326*100)/100;d.style("opacity",.9).html(`<b>${e.label}</b><br>count: ${e.count}<br>expected count: ${s}`)})).on("mousemove",(t=>d.style("left",t.pageX+20+"px").style("top",t.pageY-11+"px"))).on("mouseout",(()=>d.style("opacity",0)))},attachCDFPlot=(t,e)=>{const s=500,a=10,o=20,n=30,l=10,r=[{x:0,y:0}],d=[{x:0,y:0}],c=Object.values(e).reduce(((t,e)=>t+e),0),i=Object.keys(handValueMap).sort(((t,e)=>handValueMap[t]-handValueMap[e])).reverse();let p=0,u=0,m=0;for(let t=0;t<169;t++){const s=i[t],a=2===s.length,o=3===s.length&&"s"===s.slice(-1);p+=.005917159763313609,u+=e[s]?e[s]/c:0,m+=(a?6:o?4:12)/1326,r.push({x:p,y:u}),d.push({x:p,y:m})}const h=[{data:d,colourHex:"#989898",label:"expected"},{data:r,colourHex:"#be1931",label:"actual"}],x=d3.select("#"+t).append("svg").attr("width",500+n+l).attr("height",s+a+o).append("g").attr("transform",`translate(${n},${a})`),f=d3.scaleLinear().domain([0,1]).range([0,500]),g=d3.scaleLinear().domain([0,1]).range([s,0]);x.append("g").attr("class","x axis-grid").attr("transform","translate(0,500)").call(d3.axisBottom(f).tickSize(-500).tickFormat("").tickSizeOuter(0)),x.append("g").attr("class","y axis-grid").call(d3.axisLeft(g).tickSize(-500).tickFormat("").tickSizeOuter(0)),x.append("g").attr("class","x axis").attr("transform","translate(0,500)").call(d3.axisBottom(f)),x.append("g").attr("class","y axis").call(d3.axisLeft(g));const A=d3.line().x((t=>f(t.x))).y((t=>g(t.y)));x.selectAll(".line").data(h).enter().append("path").attr("d",(t=>A(t.data))).attr("fill","none").attr("stroke",(t=>t.colourHex)).attr("stroke-width",1.5)},attachRawCounts=(t,e)=>{for(const s of Object.keys(e).sort(((t,e)=>handValueMap[t]-handValueMap[e])).reverse()){const a=document.createElement("div");a.classList.add("results-list-item"),t.appendChild(a);const o=document.createElement("span"),n=document.createElement("span");o.classList.add("results-list-item-hand-value-span"),n.classList.add("results-list-item-hand-count-span"),a.appendChild(o),a.appendChild(n),o.textContent=s+": ",n.textContent=e[s]}},processForm=t=>{t.preventDefault&&t.preventDefault(),results.innerHTML="";const e=formTextArea.value.split(/\n/),s=processLogLines(e);if(!Object.keys(s).length)return results.textContent="no hands found. you've probably made a mistake.",!1;const a=document.createElement("h2");a.textContent="heatmap";const o=document.createElement("div"),n="results-grid-div";o.id=n,results.appendChild(a),results.appendChild(o),attachHeatmap(n,s);const l=document.createElement("h2");l.textContent="cumulative distribution function plot";const r=document.createElement("div"),d="results-cdf-plot-div";r.id=d,results.appendChild(l),results.appendChild(r),attachCDFPlot(d,s);const c=document.createElement("h2");c.textContent="raw counts";const i=document.createElement("div");return i.classList.add("results-list"),results.appendChild(c),results.appendChild(i),attachRawCounts(i,s),!1};form.attachEvent?form.attachEvent("submit",processForm):form.addEventListener("submit",processForm);
